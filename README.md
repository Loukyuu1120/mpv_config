# 📦 mpv_config

本仓库收录了一些本人自用的 MPV 小脚本，用来增强播放体验。

所有脚本均为独立文件，可按需选择使用。

---

## 📜 脚本列表

### 1. **emby-playback-reporting.lua**

将 MPV 的播放进度同步回 Emby 服务器，实现类似官方客户端的观看记录回传。

在用hills调用外部mpv时发现没有回报进度，故写此脚本。

**功能：**

- 自动汇报播放开始、暂停、继续、停止等事件

- 定时回传当前播放进度

- 支持 自定义 UA 和回传间隔

- 可在 MPV 播放 Emby URL 时自动识别媒体信息

**可配置项：**

- `report_interval`：回传间隔（秒）

- `ua_string`：自定义 UA

### **2. emby-next-episode.lua**

自动获取并添加 Emby 剧集的下一集到 MPV 播放列表，并修复标题显示。

解决外部调用 MPV 播放 Emby 链接时，无法自动连播下一集以及标题只显示 URL 的问题。

**功能：**

- 自动识别 Emby 播放链接并获取当前剧集信息

- 自动获取 **下一集** 播放地址并追加到播放列表（实现无缝连播）

- 自动获取并设置当前视频及下一集的 **真实标题**（解决 OSD 只显示 URL 乱码的问题）

- 支持 **异步重试机制**：网络请求失败时后台等待并重试，不卡顿播放器

- 静默运行模式，减少打扰

**可配置项：**

- `device_name`：自定义设备名称（显示在 Emby 后台）

- `retry_delay`：重试等待间隔（秒）

- `max_retries`：最大重试次数

- `timeout`：请求超时时间

### **3. net-speed.lua**

采用高精度积分算法的网速显示脚本，提供任务管理器级别的准确度。

**功能：**

- **高精度算法**：采用 0.1秒 高频采样 + 滑动时间窗积分，网速显示平滑且灵敏

- **协议补偿**：支持 TCP/IP 协议头补偿（默认 1.05倍），数值更接近真实带宽占用

- **智能过滤**：自动识别网络流，并支持 **本地挂载网盘**（如 Alist/Rclone）白名单显示

- **极致美化**：支持自定义字体、颜色、阴影、边框及屏幕位置（ASS 渲染）

- 支持快捷键开关及自动休眠（无缓冲时不显示）Ctrl+n 未绑定其他按键可以直接用。绑定了其他按键可以自定义 ，示例 (`input.conf`)：
  
  ```
  n script-binding net_speed/toggle
  ```

**可配置项：**

- `integration_window`：积分统计窗口（秒），决定数值的稳定性

- `overhead_compensation`：协议开销补偿系数（推荐 1.05）

- `allow_local_prefixes`：本地路径白名单（用于显示挂载盘网速）

- `position` / `font_face`：屏幕位置与字体样式设置
